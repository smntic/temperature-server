<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Temperature Server</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
      :root {
        --bg: #0b0f14;
        --panel: #121826;
        --panel-soft: #0f1420;
        --border: rgba(255,255,255,0.06);
        --muted: #94a3b8;
        --text: #e5e7eb;
      }

      .panel {
        background: var(--panel);
        border: 1px solid var(--border);
        border-radius: 1rem;
        padding: 1.25rem;
      }

      .label {
        font-size: 0.7rem;
        letter-spacing: 0.12em;
        text-transform: uppercase;
        color: var(--muted);
      }

      .stat-value {
        margin-top: 0.25rem;
        font-size: 1.9rem;
        font-weight: 600;
        color: #fff;
      }

      .timespan {
        display: inline-flex;
        gap: 0.25rem;
        background: var(--panel-soft);
        border: 1px solid var(--border);
        border-radius: 0.75rem;
        padding: 0.25rem;
      }

      .timespan button {
        appearance: none;
        background: transparent;
        border: none;
        padding: 0.35rem 0.65rem;
        border-radius: 0.5rem;
        font-size: 0.85rem;
        letter-spacing: 0.05em;
        text-transform: uppercase;
        color: var(--muted);
        cursor: pointer;
      }

      .timespan button:hover {
        background: rgba(255,255,255,0.06);
        color: var(--text);
      }

      .timespan button.active {
        background: var(--panel);
        color: #fff;
      }
    </style>
  </head>
  <body class="min-h-screen bg-[var(--bg)] text-[var(--text)] flex items-center justify-center">
    <main class="w-full max-w-6xl px-6 py-10 flex flex-col items-center gap-4">
      <!-- Stats -->
      <section class="panel flex gap-12">
        <div>
          <div class="label">Temperature</div>
          <div class="stat-value" id="tempStat">22.4<span class="text-base text-slate-400">°C</span></div>
        </div>
        <div>
          <div class="label">Humidity</div>
          <div class="stat-value" id="humidityStat">48<span class="text-base text-slate-400">%</span></div>
        </div>
      </section>

      <!-- Timespan -->
      <section class="flex justify-center">
        <div class="timespan" id="timespan">
          <button data-span="24h">24h</button>
          <button data-span="12h">12h</button>
          <button data-span="6h" class="active">6h</button>
          <button data-span="1h">1h</button>
          <button data-span="15m">15m</button>
        </div>
      </section>

      <!-- Charts -->
      <section class="w-full flex flex-col gap-2">
        <div class="panel">
          <div class="label mb-3">Temperature</div>
          <div class="h-64"><canvas id="tempChart"></canvas></div>
        </div>
        <div class="panel">
          <div class="label mb-3">Humidity</div>
          <div class="h-64"><canvas id="humidityChart"></canvas></div>
        </div>
      </section>
    </main>

    <script>
      const TIMESPANS = {
        '24h': { minutes: 24*60, step: 60 },
        '12h': { minutes: 12*60, step: 60 },
        '6h':  { minutes: 6*60,  step: 30 },
        '1h':  { minutes: 1*60,  step: 5  },
        '15m': { minutes: 15,    step: 1  }
      };
      const DEFAULT_TIMESPAN = '6h';
      // DATA is sampled every minute
      const DATA = {
        temp: [19,19.5,20,20.2,20.5,20.8,21,21.2],
        humidity: [55,54,54,53,53,52,52,51],
      }

      const chartOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: {
          x: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#94a3b8' } },
          y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#94a3b8' } }
        }
      };

      function createChart(id) {
        return new Chart(document.getElementById(id), {
          type: 'line',
          data: { labels: [], datasets: [{ data: [], borderWidth: 2, tension: 0.35 }] },
          options: chartOptions
        });
      }

      const tempChart = createChart('tempChart');
      const humidityChart = createChart('humidityChart');

      function setData(span) {
        const { minutes, step } = TIMESPANS[span];
        const len = DATA.temp.length;
      
        let labels = [];
        let tempData = [];
        let humidityData = [];
      
        for (let i = len-1; i >= Math.max(0, len-1-minutes); i -= step) {
          const minutesAgo = len-1-i;
          labels.push(minutesAgo >= 60 ? `-${Math.round(minutesAgo/60*10)/10}h` : `-${minutesAgo}m`);
          tempData.push(DATA.temp[i]);
          humidityData.push(DATA.humidity[i]);
        }

        labels = labels.reverse();
        tempData = tempData.reverse();
        humidityData = humidityData.reverse();
      
        tempChart.data.labels = labels;
        tempChart.data.datasets[0].data = tempData;
        tempChart.update();
      
        humidityChart.data.labels = labels;
        humidityChart.data.datasets[0].data = humidityData;
        humidityChart.update();
      
        return [tempData, humidityData];
      }

      function setTimespan(span) {
        document.querySelectorAll('#timespan button').forEach(b => {
          b.classList.toggle('active', b.dataset.span === span);
        });

        const [tempData, humidityData] = setData(span);

        document.getElementById('tempStat').innerHTML = `${tempData.at(-1)}<span class="text-base text-slate-400">°C</span>`;
        document.getElementById('humidityStat').innerHTML = `${humidityData.at(-1)}<span class="text-base text-slate-400">%</span>`;
      }

      document.querySelectorAll('#timespan button').forEach(btn => {
        btn.addEventListener('click', () => setTimespan(btn.dataset.span));
      });

      setTimespan(DEFAULT_TIMESPAN);
    </script>
  </body>
</html>
